# RFC: m-select Component

**Status:** Draft  
**Author:** LFDS Team  
**Created:** 2025-11-04  
**Updated:** 2025-11-04

> ðŸ’¬ **[Discuss this RFC](https://github.com/Mmmgnus/m/discussions/new?category=rfcs&title=RFC:%20m-select%20Component)** - Share feedback, ask questions, or suggest improvements

---

## Summary

A select/dropdown component that wraps the native `<select>` element using the Shadow DOM + Slot pattern, with progressive enhancement to support the new customizable select features when available. This component provides style isolation while maintaining perfect accessibility and native form behavior.

---

## Motivation

Select dropdowns are fundamental form controls used for choosing from a list of options. The m-select component will:

- Provide consistent styling across the design system
- Leverage new customizable select features for better design control
- Maintain full accessibility with fallback to native select
- Support theming through CSS custom properties
- Work seamlessly with native form behavior and validation
- Follow established patterns from m-button, m-input, m-checkbox, and m-radio components
- Position M as a modern, standards-forward design system

---

## Design

### Component Architecture

The m-select component follows the **Shadow DOM + Slot pattern** for form components as defined in ADR-001:

- Uses shadow DOM for style isolation
- Native `<select>` stays in light DOM for accessibility
- Styles applied via `::slotted()` selectors and CSS custom properties
- Progressive enhancement for new customizable select features
- Fallback to traditional select for broader browser support

### Progressive Enhancement Strategy

The component will detect and use new customizable select features when available:

**Modern browsers (with customizable select support):**
```html
<select>
  <button type="select">
    <selectedoption></selectedoption>
  </button>
  <listbox>
    <option value="1">Option 1</option>
  </listbox>
</select>
```

**Fallback (traditional select):**
```html
<select>
  <option value="1">Option 1</option>
</select>
```

### Visual States

The component supports the following visual states:

1. **Default** - Closed dropdown, no selection
2. **Selected** - Closed dropdown with value
3. **Open** - Dropdown expanded showing options
4. **Focus** - Keyboard focus indicator
5. **Hover** - Mouse hover on button/options
6. **Disabled** - Both closed and open disabled states
7. **Error** - Invalid/error state (for form validation)

### Props/Attributes

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `label` | `string` | `''` | Label text displayed above the select |
| `help` | `string` | `''` | Help text displayed below the select |
| `error` | `string` | `''` | Error message (overrides help text) |
| `required` | `boolean` | `false` | Whether the select is required |
| `size` | `string` | `'medium'` | Size variant (`small`, `medium`, `large`) |

**Note:** The native `<select>` element inside the slot maintains its own native attributes (`name`, `value`, `disabled`, `required`, `multiple`, etc.).

---

## Accessibility Requirements

### WCAG Compliance

The component must meet WCAG 2.1 Level AAA standards:

#### Perceivable
- **Color contrast:** Minimum 4.5:1 for normal text, 3:1 for UI components
- **Visual indicators:** Clear visual distinction between states
- **Focus indicators:** Clearly visible focus state with minimum 2px outline
- **Selected state:** Clear indication of selected option

#### Operable
- **Keyboard navigation:** Full keyboard support via native select behavior
  - `Tab` to navigate to select
  - `Space`/`Enter` to open dropdown
  - `Arrow keys` to navigate options
  - `Esc` to close dropdown
  - Type-ahead search for options
- **Touch targets:** Minimum 44Ã—44px touch target size for mobile
- **No timing:** No time-based interactions required

#### Understandable
- **Labels:** Clear association between label and select
- **Error messages:** Clear, programmatically associated error messages
- **Option text:** Clear, descriptive option labels

#### Robust
- **Native semantics:** Uses native `<select>` for maximum compatibility
- **ARIA support:** All ARIA attributes work without shadow DOM limitations
  - `aria-labelledby`
  - `aria-describedby`
  - `aria-invalid`
  - `aria-required`
- **Progressive enhancement:** Degrades gracefully in older browsers

### Screen Reader Support

- Must announce role as "combobox" or "select"
- Must announce label text
- Must announce selected value
- Must announce when dropdown is expanded/collapsed
- Must announce disabled state
- Must announce error messages when invalid
- Must announce number of options (if supported by new select API)

### Keyboard Interaction

Following native HTML select behavior:

- `Tab`: Move focus to the select
- `Space`/`Enter`: Open the dropdown (when closed)
- `Arrow Up/Down`: Navigate through options
- `Home`/`End`: Jump to first/last option
- `Esc`: Close the dropdown (when open)
- `Type-ahead`: Jump to option starting with typed characters

---

## API Design

### Component Usage

```html
<!-- Basic usage -->
<m-select label="Choose your country">
  <select name="country">
    <option value="">Select...</option>
    <option value="us">United States</option>
    <option value="uk">United Kingdom</option>
    <option value="ca">Canada</option>
  </select>
</m-select>

<!-- With pre-selected value -->
<m-select label="Preferred language">
  <select name="language">
    <option value="en" selected>English</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
  </select>
</m-select>

<!-- With help text -->
<m-select label="Timezone" help="Used for scheduling notifications">
  <select name="timezone">
    <option value="utc">UTC</option>
    <option value="est">Eastern</option>
    <option value="pst">Pacific</option>
  </select>
</m-select>

<!-- With error -->
<m-select label="Payment method" error="Please select a payment method">
  <select name="payment" required>
    <option value="">Choose...</option>
    <option value="card">Credit Card</option>
    <option value="paypal">PayPal</option>
  </select>
</m-select>

<!-- Disabled -->
<m-select label="Unavailable option">
  <select name="unavailable" disabled>
    <option value="1">Option 1</option>
  </select>
</m-select>

<!-- Size variants -->
<m-select label="Small" size="small">
  <select name="small"><option>Option</option></select>
</m-select>

<m-select label="Large" size="large">
  <select name="large"><option>Option</option></select>
</m-select>
```

### With Option Groups

```html
<m-select label="Choose a fruit">
  <select name="fruit">
    <optgroup label="Citrus">
      <option value="orange">Orange</option>
      <option value="lemon">Lemon</option>
    </optgroup>
    <optgroup label="Berries">
      <option value="strawberry">Strawberry</option>
      <option value="blueberry">Blueberry</option>
    </optgroup>
  </select>
</m-select>
```

### Multiple Selection

```html
<m-select label="Choose languages" help="Hold Ctrl/Cmd to select multiple">
  <select name="languages" multiple size="4">
    <option value="en">English</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
    <option value="de">German</option>
  </select>
</m-select>
```

### With ARIA Attributes

```html
<span id="country-help">Choose your shipping destination</span>

<m-select label="Country">
  <select 
    name="country" 
    required
    aria-describedby="country-help"
    aria-invalid="false">
    <option value="">Select...</option>
    <option value="us">United States</option>
  </select>
</m-select>
```

---

## CSS Custom Properties

### Component-Specific Properties

```css
/* Size and spacing */
--m-select-min-width: 200px;
--m-select-padding: 0.5rem 0.75rem;
--m-select-gap: 0.5rem;

/* Border */
--m-select-border-width: 1px;
--m-select-border-color: #ccc;
--m-select-border-radius: 0.25rem;

/* Background */
--m-select-background: white;
--m-select-background-hover: #f9f9f9;

/* Text */
--m-select-color: inherit;
--m-select-font-size: 1rem;

/* Dropdown icon */
--m-select-icon-size: 1rem;
--m-select-icon-color: #666;

/* States */
--m-select-border-color-focus: var(--m-color-primary, #0066cc);
--m-select-border-color-error: var(--m-color-error, #dc3545);
--m-select-opacity-disabled: 0.6;

/* Focus indicator */
--m-select-focus-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);

/* Dropdown/Listbox (for customizable select) */
--m-select-listbox-background: white;
--m-select-listbox-border: 1px solid #e2e8f0;
--m-select-listbox-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
--m-select-listbox-max-height: 300px;

/* Option */
--m-select-option-padding: 0.5rem 0.75rem;
--m-select-option-background-hover: #f3f4f6;
--m-select-option-background-selected: #e0f2fe;
--m-select-option-color-selected: #0369a1;

/* Size variants */
--m-select-padding-small: 0.25rem 0.5rem;
--m-select-font-size-small: 0.875rem;
--m-select-padding-large: 0.75rem 1rem;
--m-select-font-size-large: 1.125rem;

/* Label */
--m-select-label-margin: 0.5rem;
--m-select-label-font-size: 0.875rem;
--m-select-label-font-weight: 500;
--m-select-label-color: #333;

/* Help/Error text */
--m-select-message-margin: 0.25rem;
--m-select-message-font-size: 0.875rem;
--m-select-help-color: #666;
--m-select-error-color: var(--m-color-error, #dc3545);
```

### Global Design Tokens

```css
/* Colors */
--m-color-primary: #0066cc;
--m-color-primary-hover: #0052a3;
--m-color-error: #dc3545;

/* Typography */
--m-font-family: inherit;
--m-font-size-base: 1rem;
--m-font-size-small: 0.875rem;
--m-font-size-large: 1.125rem;

/* Spacing */
--m-spacing-sm: 0.25rem;
--m-spacing-md: 0.5rem;
--m-spacing-lg: 0.75rem;
```

---

## Implementation Notes

### Technical Approach

1. **Component Structure**
   - Extends `LitElement`
   - Uses shadow DOM for style isolation
   - Wraps content similar to m-input pattern
   - Renders native select in default slot with label, help, error
   - Detects customizable select support via feature detection

2. **Styling Strategy**
   - Use `::slotted(select)` for basic select styling
   - Use `::part()` selectors for customizable select parts when available
   - Provide fallback styles for traditional select
   - All theming via CSS custom properties
   - Custom dropdown icon via background-image

3. **Progressive Enhancement**
   - Feature-detect customizable select API
   - Optionally enhance markup when supported
   - Graceful fallback to traditional select
   - Same accessibility guarantees in both modes

4. **Label and Error Handling**
   - Similar pattern to m-input
   - Label rendered in shadow DOM with click forwarding
   - Help/error text in light DOM for ARIA association
   - Error state reflected on host

### File Structure

```
packages/components/src/select/
â”œâ”€â”€ m-select.js           # Select component
â””â”€â”€ select.md             # Usage documentation
```

### Dependencies

- `lit` (version 3.0+)
- No additional dependencies

### Browser Support

**Full support (customizable select):**
- Chrome/Edge 119+ (with flag)
- Future: Firefox, Safari when shipped

**Fallback support (traditional select):**
- All modern browsers supporting:
  - Custom Elements v1
  - Shadow DOM v1
  - ES Modules
  - CSS Custom Properties

---

## Testing Requirements

### Manual Testing Checklist

- [ ] Visual states render correctly (default, selected, open, focus, hover, disabled, error)
- [ ] Label displays correctly and focuses select when clicked
- [ ] Help text displays correctly
- [ ] Error state displays and overrides help text
- [ ] Focus indicator is clearly visible
- [ ] Keyboard navigation works (Tab, Space, Arrow keys, Esc, type-ahead)
- [ ] Option groups display correctly
- [ ] Multiple selection works
- [ ] Form submission includes correct values
- [ ] Disabled state prevents interaction
- [ ] Size variants display correctly
- [ ] CSS custom properties can be overridden
- [ ] Works in browsers with and without customizable select support
- [ ] Mobile native picker works (iOS/Android)

### Accessibility Testing Checklist

- [ ] Screen reader announces "combobox" or "select"
- [ ] Screen reader announces label text
- [ ] Screen reader announces selected value
- [ ] Screen reader announces when dropdown opens/closes
- [ ] Screen reader announces disabled state
- [ ] Screen reader announces error messages
- [ ] Keyboard-only navigation works completely
- [ ] Focus indicators meet WCAG AAA standards
- [ ] Color contrast meets WCAG AAA standards (7:1 for text, 4.5:1 for UI)
- [ ] Touch targets are minimum 44Ã—44px
- [ ] ARIA attributes work correctly across shadow boundary
- [ ] Label association works correctly

### Automated Testing

- Unit tests for component registration
- Feature detection for customizable select
- Custom Elements Manifest validation
- TypeScript definition validation

---

## Migration & Rollout

### Phase 1: Initial Implementation
- Create m-select component with traditional select
- Support all basic features (label, help, error, sizes)
- Generate Custom Elements Manifest and TypeScript definitions
- Create manual test page

### Phase 2: Progressive Enhancement
- Add feature detection for customizable select
- Implement enhanced styling when available
- Test in browsers with customizable select support
- Document browser support status

### Phase 3: Documentation
- Add component to documentation site
- Create usage examples
- Document accessibility features
- Document browser support and fallback strategy
- Create migration guide when customizable select becomes standard

### Phase 4: Integration
- Add m-select to auto-register.js
- Update package.json exports
- Create usage examples and stories

---

## Open Questions

1. Should we provide a fully custom select option for maximum design control?
2. How should we handle option icons/images (common design pattern)?
3. Should we support searchable/filterable select?
4. Should we provide a "native mobile picker only" mode?

---

## References

### Design System Documentation
- [ARCHITECTURE.md](../ARCHITECTURE.md) - Form Components Architecture (Shadow DOM + Slot pattern)
- [COMPONENT_GUIDELINES.md](../COMPONENT_GUIDELINES.md) - Form Component Template

### Existing Components
- [m-button](../../packages/components/src/button/m-button.js) - Reference implementation using Shadow DOM + Slot pattern
- [m-input](../../packages/components/src/input/m-input.js) - Similar wrapper component with label and error handling
- [m-checkbox](../../packages/components/src/checkbox/m-checkbox.js) - Form component with label support
- [m-radio](../../packages/components/src/radio/m-radio.js) - Form component with label support

### Standards & Specifications
- [HTML Standard: Select Element](https://html.spec.whatwg.org/multipage/form-elements.html#the-select-element)
- [Open UI: Select (Customizable)](https://open-ui.org/components/selectlist.explainer/)
- [ARIA: Combobox Pattern](https://www.w3.org/WAI/ARIA/apg/patterns/combobox/)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)

---

## Related Decisions (ADR)

- [ADR-001: Shadow DOM + Slot Pattern for Form Components](../adr/001-shadow-dom-slot-pattern-for-form-components.md) - Architectural decision for form component implementation pattern

---

## Changelog

- **2025-11-04**: Initial RFC created by LFDS Team
